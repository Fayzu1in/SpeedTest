<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="status">&nbsp;</div>
    <h1 id="progress">&nbsp;</h1>
    <img id="img" />
    <script>
      const elStatus = document.getElementById("status");
      function status(text) {
        elStatus.innerHTML = text;
      }

      const elProgress = document.getElementById("progress");
      function progress({ loaded, total }) {
        elProgress.innerHTML = Math.round((loaded / total) * 100) + "%";
      }

      async function main() {
        status("downloading with fetch()...");
        const response = await fetch("https://st16.allmovies.uz/test.bin", {
          mode: "no-cors",
        });
        const contentLength = response.headers.get("content-length");
        const total = parseInt(contentLength, 10);
        let loaded = 0;

        const res = new Response(
          new ReadableStream({
            async start(controller) {
              const reader = response.body.getReader();
              for (;;) {
                const { done, value } = await reader.read();
                if (done) break;
                loaded += value.byteLength;
                progress({ loaded, total });
                controller.enqueue(value);
              }
              controller.close();
            },
          })
        );
        const blob = await res.blob();
        status("download completed");
        document.getElementById("img").src = URL.createObjectURL(blob);
      }

      main();
    </script>
  </body>
</html>
